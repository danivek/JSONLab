!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const e={format(e,t=2){try{const n=JSON.parse(e);return JSON.stringify(n,null,t)}catch(n){throw new Error(`Format error: ${n.message}`)}},compact(e){try{const t=JSON.parse(e);return JSON.stringify(t)}catch(t){throw new Error(`Compact error: ${t.message}`)}},validate(e){try{return JSON.parse(e),{valid:!0,error:null}}catch(t){const n=t.message.match(/position (\d+)/);let i=null;if(n){const t=parseInt(n[1]);i=e.substring(0,t).split("\n").length}return{valid:!1,error:t.message,line:i}}},repair(e){try{return JSONRepair.jsonrepair(e)}catch(t){throw new Error(`Could not repair JSON: ${t.message}`)}},safeParse(e){try{return JSON.parse(e)}catch{return null}},getType:e=>null===e?"null":Array.isArray(e)?"array":typeof e,getSize(e){const t=new Blob([e]).size,n=e.split("\n").length;let i;return i=t<1024?`${t} bytes`:t<1048576?`${(t/1024).toFixed(1)} KB`:`${(t/1048576).toFixed(1)} MB`,{bytes:t,lines:n,sizeStr:i}},clone:e=>JSON.parse(JSON.stringify(e)),flatten(e,t=""){const n={};for(const i in e){const o=t?`${t}.${i}`:i;"object"!=typeof e[i]||null===e[i]||Array.isArray(e[i])?n[o]=e[i]:Object.assign(n,this.flatten(e[i],o))}return n},getPathAtOffset(e,t){if(!e||t<0)return null;t>=e.length&&(t=e.length-1);let n=0,i=[],o=!1,r=-1,s=!1,a=[],l=null;const d=()=>n>=t;for(;n<e.length;){const t=e[n];if(o){if('"'===t&&"\\"!==e[n-1]){o=!1;const t=e.substring(r+1,n);if(s&&(l=t,s=!1),d())break}}else{if(d())break;if('"'===t)o=!0,r=n;else if("{"===t){if(a.length>0){const e=a[a.length-1];"array"===e.type?i.push(e.count):"object"===e.type&&null!==l&&(i.push(l),l=null)}a.push({type:"object",count:0}),s=!0}else if("["===t){if(a.length>0){const e=a[a.length-1];"array"===e.type?i.push(e.count):"object"===e.type&&null!==l&&(i.push(l),l=null)}a.push({type:"array",count:0})}else if("}"===t)a.length>0&&(a.pop(),i.pop());else if("]"===t)a.length>0&&(a.pop(),i.pop());else if(":"===t);else if(","===t&&a.length>0){const e=a[a.length-1];"array"===e.type?e.count++:"object"===e.type&&(s=!0,l=null)}}n++}if(a.length>0){const e=a[a.length-1];"array"===e.type?i.push(e.count):"object"===e.type&&null!==l&&i.push(l)}return i},sortKeys(e){if(Array.isArray(e))return e.map(e=>this.sortKeys(e));if("object"==typeof e&&null!==e){const t={};return Object.keys(e).sort().forEach(n=>{t[n]=this.sortKeys(e[n])}),t}return e}};window.JsonUtils=e;const t={jsonToCsv(e,t=","){if(!Array.isArray(e))throw new Error("JSON must be an array to convert to CSV");if(0===e.length)return"";const n=new Set;e.forEach(e=>{"object"==typeof e&&null!==e&&Object.keys(e).forEach(e=>n.add(e))});const i=Array.from(n);return[i.map(e=>this.escapeCell(e,t)).join(t),...e.map(e=>i.map(n=>{const i=e&&e[n];return this.escapeCell(this.formatValue(i),t)}).join(t))].join("\n")},csvToJson(e,t=","){const n=this.parseCSVLines(e,t);if(0===n.length)return[];const i=n[0],o=[];for(let r=1;r<n.length;r++){const e=n[r];if(0===e.length||1===e.length&&""===e[0])continue;const t={};i.forEach((n,i)=>{const o=e[i]||"";t[n]=this.parseValue(o)}),o.push(t)}return o},parseCSVLines(e,t=","){const n=[];let i=[],o="",r=!1;for(let s=0;s<e.length;s++){const a=e[s],l=e[s+1];r?'"'===a?'"'===l?(o+='"',s++):r=!1:o+=a:'"'===a?r=!0:a===t?(i.push(o.trim()),o=""):"\n"===a||"\r"===a&&"\n"===l?(i.push(o.trim()),n.push(i),i=[],o="","\r"===a&&s++):"\r"!==a&&(o+=a)}return(o||i.length>0)&&(i.push(o.trim()),n.push(i)),n},escapeCell(e,t=","){const n=String(e);return n.includes('"')||n.includes(t)||n.includes("\n")||n.includes("\r")?'"'+n.replace(/"/g,'""')+'"':n},formatValue:e=>null==e?"":"object"==typeof e?JSON.stringify(e):String(e),parseValue(e){const t=e.trim();if(""===t)return"";if("null"===t.toLowerCase())return null;if("true"===t.toLowerCase())return!0;if("false"===t.toLowerCase())return!1;if(!isNaN(t)&&""!==t){const e=Number(t);if(!isNaN(e))return e}if(t.startsWith("{")&&t.endsWith("}")||t.startsWith("[")&&t.endsWith("]"))try{return JSON.parse(t)}catch{}return t},detectDelimiter(e){const t=[",",";","\t","|"],n=e.split("\n")[0];let i=0,o=",";for(const r of t){const e=(n.match(new RegExp("\t"===r?"\t":`\\${r}`,"g"))||[]).length;e>i&&(i=e,o=r)}return o}};window.CsvUtils=t;const n={compare(e,t){const n=[];return this.compareRecursive(e,t,"",n),n},compareRecursive(e,t,n,i){if(null==e)return void(null!=t&&i.push({type:"added",path:n,value:t}));if(null==t)return void i.push({type:"removed",path:n,value:e});if(typeof e!=typeof t)return void i.push({type:"modified",path:n,oldValue:e,newValue:t});if(Array.isArray(e)!==Array.isArray(t))return void i.push({type:"modified",path:n,oldValue:e,newValue:t});if("object"!=typeof e)return void(e!==t&&i.push({type:"modified",path:n,oldValue:e,newValue:t}));if(Array.isArray(e)){const o=Math.max(e.length,t.length);for(let r=0;r<o;r++){const o=n?`${n}[${r}]`:`[${r}]`;r>=e.length?i.push({type:"added",path:o,value:t[r]}):r>=t.length?i.push({type:"removed",path:o,value:e[r]}):this.compareRecursive(e[r],t[r],o,i)}return}const o=new Set([...Object.keys(e),...Object.keys(t)]);for(const r of o){const o=n?`${n}.${r}`:r;r in e?r in t?this.compareRecursive(e[r],t[r],o,i):i.push({type:"removed",path:o,value:e[r]}):i.push({type:"added",path:o,value:t[r]})}},formatDiffs(e){return 0===e.length?"No differences found.":e.map(e=>{const t=e.path||"(root)";switch(e.type){case"added":return`+ ${t}: ${this.formatValue(e.value)}`;case"removed":return`- ${t}: ${this.formatValue(e.value)}`;case"modified":return`~ ${t}: ${this.formatValue(e.oldValue)} → ${this.formatValue(e.newValue)}`;default:return""}}).join("\n")},formatDiffsHtml(e){return 0===e.length?'<p style="color: var(--color-success);">✓ No differences found.</p>':e.map(e=>{const t=this.escapeHtml(e.path||"(root)");switch(e.type){case"added":return`<div class="diff-added">+ ${t}: ${this.escapeHtml(this.formatValue(e.value))}</div>`;case"removed":return`<div class="diff-removed">- ${t}: ${this.escapeHtml(this.formatValue(e.value))}</div>`;case"modified":return`<div class="diff-modified">~ ${t}: <span class="diff-removed">${this.escapeHtml(this.formatValue(e.oldValue))}</span> → <span class="diff-added">${this.escapeHtml(this.formatValue(e.newValue))}</span></div>`;default:return""}}).join("\n")},formatValue:e=>"string"==typeof e?`"${e}"`:"object"==typeof e?JSON.stringify(e):String(e),escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML},lineDiff(e,t){const n=e.split("\n"),i=t.split("\n"),o=[],r=Math.max(n.length,i.length);for(let s=0;s<r;s++){const e=n[s],t=i[s];void 0===e?o.push({type:"added",lineNum:s+1,content:t}):void 0===t?o.push({type:"removed",lineNum:s+1,content:e}):e!==t?(o.push({type:"removed",lineNum:s+1,content:e}),o.push({type:"added",lineNum:s+1,content:t})):o.push({type:"unchanged",lineNum:s+1,content:e})}return o}};window.DiffUtils=n;const i={query(e,t){if(!t||"$"===t)return[e];try{const n=this.tokenize(t);return this.evaluate(e,n)}catch(n){throw new Error(`Invalid JSONPath: ${n.message}`)}},tokenize(e){const t=[];let n=0;for("$"===e[0]&&(n=1);n<e.length;){const i=e[n];if("."===i)if(n++,"."===e[n]){n++;const i=this.readKey(e,n);t.push({type:"recursive",key:i.value}),n=i.end}else if("*"===e[n])t.push({type:"wildcard"}),n++;else{const i=this.readKey(e,n);t.push({type:"key",key:i.value}),n=i.end}else if("["===i){n++;const i=this.readBracket(e,n);t.push(i.token),n=i.end}else{const i=this.readKey(e,n);i.value&&t.push({type:"key",key:i.value}),n=i.end}}return t},readKey(e,t){let n="",i=t;for(;i<e.length&&"."!==e[i]&&"["!==e[i];)n+=e[i],i++;return{value:n,end:i}},readBracket(e,t){let n="",i=t;for(;i<e.length&&"]"!==e[i];)n+=e[i],i++;if(i++,"*"===n)return{token:{type:"wildcard"},end:i};if(n.includes(":")){const e=n.split(":").map(e=>""===e.trim()?null:parseInt(e));return{token:{type:"slice",start:e[0],end:e[1]},end:i}}if(n.startsWith("'")||n.startsWith('"')){return{token:{type:"key",key:n.slice(1,-1)},end:i}}return isNaN(n)?{token:{type:"key",key:n},end:i}:{token:{type:"index",index:parseInt(n)},end:i}},evaluate(e,t){let n=[e];for(const i of t){const e=[];for(const t of n)switch(i.type){case"key":t&&"object"==typeof t&&i.key in t&&e.push(t[i.key]);break;case"index":if(Array.isArray(t)&&i.index<t.length){const n=i.index<0?t.length+i.index:i.index;n>=0&&n<t.length&&e.push(t[n])}break;case"wildcard":Array.isArray(t)?e.push(...t):t&&"object"==typeof t&&e.push(...Object.values(t));break;case"slice":if(Array.isArray(t)){const n=i.start??0,o=i.end??t.length;e.push(...t.slice(n,o))}break;case"recursive":e.push(...this.recursiveSearch(t,i.key))}n=e}return n},recursiveSearch(e,t){const n=[],i=e=>{if(e&&"object"==typeof e)if(Array.isArray(e))for(const t of e)i(t);else{t in e&&n.push(e[t]);for(const t of Object.values(e))i(t)}};return i(e),n},getSuggestions(e,t){const n=[];try{const i=Math.max(t.lastIndexOf("."),t.lastIndexOf("[")),o=i>0?t.substring(0,i):"$",r=this.query(e,o);for(const e of r)if(e&&"object"==typeof e)if(Array.isArray(e))n.push("[0]","[*]");else for(const t of Object.keys(e))n.push(`.${t}`)}catch{}return[...new Set(n)].slice(0,20)}};window.QueryUtils=i;const o={load:async()=>new Promise(e=>{require.config({paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.55.1/min/vs"}}),require(["vs/editor/editor.main"],()=>{monaco.editor.defineTheme("json-light",{base:"vs",inherit:!0,rules:[],colors:{"editor.background":"#ffffff","editorStickyScroll.background":"#eaeaea","editorStickyScrollHover.background":"#e0e0e0","editorStickyScroll.shadow":"#d0d0d0","editorStickyScroll.border":"#cccccc"}}),monaco.editor.defineTheme("json-dark",{base:"vs-dark",inherit:!0,rules:[],colors:{"editor.background":"#1e1e1e","editorStickyScroll.background":"#2d2d30","editorStickyScrollHover.background":"#3a3a3c","editorStickyScroll.shadow":"#000000","editorStickyScroll.border":"#454545"}}),e()})}),getDefaultJson:()=>JSON.stringify({company:{id:"CORP-ECORP-001",name:"E Corp (Evil Corp)",founded:"1984-06-10",active:!0,revenue:942e9,employeeCount:215e3,headquarters:{address:{street:"1 World Trade Center",suite:"Floors 90-105",city:"New York",state:"NY",zip:"10007",country:"USA",coordinates:{lat:40.7127,lng:-74.0134}},phone:"+1-212-555-0100",email:"contact@ecorp.com",website:"https://www.ecorp.com"},offices:[{id:"OFF-001",city:"Washington D.C.",country:"USA",employees:3200,timezone:"America/New_York"},{id:"OFF-002",city:"Shanghai",country:"China",employees:8400,timezone:"Asia/Shanghai"},{id:"OFF-003",city:"London",country:"UK",employees:5100,timezone:"Europe/London"},{id:"OFF-004",city:"Washington Township",country:"USA",employees:620,timezone:"America/New_York",notes:"Site of controversial nuclear facility and toxic waste cover-up"}],socialMedia:{twitter:"@ECorp",linkedin:"evil-corp-ecorp",github:"ecorp-dev"}},departments:[{id:"DEPT-001",name:"Cybersecurity (via Allsafe)",head:"EMP-1001",budget:45e6,teams:["Network Defense","Incident Response","Threat Intelligence","Penetration Testing"],headcount:38},{id:"DEPT-002",name:"Public Relations",head:"EMP-1003",budget:12e7,teams:["Crisis Communications","Media Relations","Internal PR","Brand Strategy"],headcount:210},{id:"DEPT-003",name:"Executive Office",head:"EMP-1007",budget:3e8,teams:["C-Suite","Legal","Compliance","Lobbying"],headcount:52},{id:"DEPT-004",name:"E Coin & Digital Finance",head:"EMP-1008",budget:89e7,teams:["Blockchain Infrastructure","Consumer Banking","Monetary Policy"],headcount:430}],employees:[{id:"EMP-1001",firstName:"Elliot",lastName:"Alderson",email:"elliot.alderson@allsafe.com",phone:"+1-646-555-0183",role:"Senior Cybersecurity Engineer",department:"DEPT-001",level:"L4",startDate:"2013-04-15",salary:87e3,currency:"USD",remote:!1,skills:["Network Penetration Testing","Reverse Engineering","Social Engineering","Rootkit Development","Kali Linux","Metasploit","Wireshark","SQL Injection","Dark Web OSINT"],certifications:[{name:"CEH - Certified Ethical Hacker",issuer:"EC-Council",issuedDate:"2012-09-01",expiryDate:"2027-09-01"},{name:"OSCP - Offensive Security Certified Professional",issuer:"Offensive Security",issuedDate:"2013-02-14",expiryDate:null}],performance:{lastReview:"2015-03-10",rating:4.9,goals:["Monitor E Corp network 24/7","Reduce incident response time by 30%"],promotionEligible:!0},address:{city:"New York",state:"NY",zip:"10034",country:"USA"},notes:"Extremely reclusive. Exceptional talent. Monitor for insider threat — possible DID diagnosis. Known morphine dependency."},{id:"EMP-1002",firstName:"Darlene",lastName:"Alderson",email:"darlene.alderson@fsociety.net",phone:"+1-646-555-0294",role:"Hacktivist / fsociety Co-Founder",department:null,level:null,startDate:"2015-01-01",salary:0,currency:"USD",remote:!0,skills:["Phishing Campaigns","Malware Deployment","Social Engineering","OSINT","Exploit Development"],certifications:[],performance:{lastReview:null,rating:null,goals:["Execute 5/9 Attack","Evade FBI surveillance"],promotionEligible:!1},address:{city:"New York",state:"NY",zip:"10002",country:"USA"},notes:"FBI informant (coerced). Elliot Alderson's sister. Core fsociety operative."},{id:"EMP-1003",firstName:"Angela",lastName:"Moss",email:"angela.moss@ecorp.com",phone:"+1-212-555-0371",role:"Senior VP of Public Relations",department:"DEPT-002",level:"VP",startDate:"2015-06-01",salary:24e4,currency:"USD",remote:!1,skills:["Crisis Communications","Media Strategy","Stakeholder Management","Executive Presentations","Regulatory Compliance"],certifications:[],performance:{lastReview:"2016-01-05",rating:4.5,goals:["Rehabilitate E Corp post-hack public image","Manage Washington Township lawsuit narrative"],promotionEligible:!0},address:{city:"New York",state:"NY",zip:"10013",country:"USA"},notes:"Mother died in Washington Township toxic leak. Initially investigated E Corp, later co-opted by Phillip Price. Ultimately manipulated by Whiterose. Deceased."},{id:"EMP-1004",firstName:"Tyrell",lastName:"Wellick",email:"tyrell.wellick@ecorp.com",phone:"+1-212-555-0452",role:"Senior Vice President of Technology / Acting CTO",department:"DEPT-003",level:"SVP",startDate:"2009-11-01",salary:48e4,currency:"USD",remote:!1,skills:["Corporate Strategy","Infrastructure Architecture","Executive Manipulation","Swedish / English / Mandarin","Network Systems Design"],certifications:[{name:"MBA - Stockholm School of Economics",issuer:"Stockholm School of Economics",issuedDate:"2005-06-01",expiryDate:null}],performance:{lastReview:"2015-04-20",rating:4.8,goals:["Secure CTO promotion","Oversee E Corp network modernization"],promotionEligible:!0},address:{city:"New York",state:"NY",zip:"10021",country:"USA"},notes:"Narcissistic personality. Murdered Sharon Knowles under extreme stress. Used as Dark Army scapegoat post-5/9. Deceased — shot by Whiterose operative."},{id:"EMP-1005",firstName:"Phillip",lastName:"Price",email:"phillip.price@ecorp.com",phone:"+1-212-555-0001",role:"Chief Executive Officer",department:"DEPT-003",level:"C-Suite",startDate:"1997-03-01",salary:28e6,currency:"USD",remote:!1,skills:["Global Economic Strategy","Political Lobbying","Financial Instruments","Corporate Governance","Psychological Manipulation"],certifications:[],performance:{lastReview:"2018-12-01",rating:4.2,goals:["Launch E Coin as global reserve currency","Maintain Deus Group influence"],promotionEligible:!1},address:{city:"New York",state:"NY",zip:"10065",country:"USA"},notes:"Member of the Deus Group. Manipulated Angela Moss as a personal obsession. Killed by Whiterose after losing control of E Coin initiative. Deceased."}],products:[{id:"PROD-001",name:"E Coin",type:"Cryptocurrency / Digital Currency",version:"2.1.0",status:"active",launchDate:"2016-03-01",pricing:{model:"market-based",tiers:[{name:"Consumer",monthlyPrice:0,annualPrice:0,currency:"USD",features:["Digital wallet","Peer-to-peer transfers","E Corp merchant payments"]},{name:"Business",monthlyPrice:299,annualPrice:2870,currency:"USD",features:["Bulk transactions","API integration","Priority settlement","Dedicated account manager"]},{name:"Government / Reserve",monthlyPrice:null,annualPrice:null,currency:"USD",features:["Reserve currency integration","Custom monetary policy tools","Direct Fed liaison","Unlimited liquidity lines"]}]},integrations:["Federal Reserve System","IMF","Global Banking Networks","E Corp Retail"],metrics:{activeUsers:214e6,monthlyActiveUsers:189e6,churnRate:.008,npsScore:34,uptime:99.95}}]},null,2)};window.TextEditor=o;window.TreeView=class{constructor(e){this.container=e,this.data=null,this.expandedPaths=new Set,this.init()}init(){}render(e){if(void 0!==e)if("string"==typeof e)try{this.data=JSON.parse(e)}catch(n){return void(this.container.innerHTML=`<p class="error" style="color: var(--color-error);">Invalid JSON: ${n.message}</p>`)}else this.data=e;if(null===this.data||void 0===this.data)return void(this.container.hasChildNodes()||(this.container.innerHTML='<p class="table-placeholder">No data to display</p>'));this.container.innerHTML="";const t=this.createNode(this.data,"",null);this.container.appendChild(t)}createNode(e,t,n){const i=n?[...n]:[];null!=t&&""!==t&&i.push(t);const o=JSON.stringify(i),r=JsonUtils.getType(e),s="object"===r||"array"===r,a=this.expandedPaths.has(o),l=document.createElement("div");l.className="tree-node",l.dataset.path=o;const d=document.createElement("div");d.className="tree-node-header",d.addEventListener("click",e=>{if(e.target.classList.contains("tree-toggle"))return;const t=this.getJsPath(i),n=this.getJsonPointer(i);window.App&&window.App.updatePathDisplay(t,n),this.container.querySelectorAll(".tree-node-header.selected").forEach(e=>e.classList.remove("selected")),d.classList.add("selected"),e.stopPropagation()});const c=document.createElement("span");if(c.className="tree-toggle"+(a?" expanded":""),c.textContent=s?"▶":"",s&&c.addEventListener("click",t=>{t.stopPropagation(),this.toggleNode(o,c,l.querySelector(".tree-children"),e,i)}),d.appendChild(c),null!==t&&""!==t){const e=document.createElement("span");e.className="tree-key",e.textContent=t,d.appendChild(e);const n=document.createElement("span");n.className="tree-separator",n.textContent=": ",d.appendChild(n)}if(s){const t=document.createElement("span");t.className="tree-type",t.textContent="array"===r?`Array[${e.length}]`:`Object{${Object.keys(e).length}}`,d.appendChild(t)}else{const t=document.createElement("span");t.className=`tree-value ${r}`,t.textContent=this.formatValue(e,r),d.appendChild(t)}if(l.appendChild(d),s){const t=document.createElement("div");t.className="tree-children"+(a?" expanded":""),a&&this.populateChildren(t,e,i),l.appendChild(t)}return l}toggleNode(e,t,n,i,o){this.expandedPaths.has(e)?(this.expandedPaths.delete(e),t.classList.remove("expanded"),n.classList.remove("expanded"),n.innerHTML=""):(this.expandedPaths.add(e),t.classList.add("expanded"),n.classList.add("expanded"),this.populateChildren(n,i,o))}populateChildren(e,t,n){Array.isArray(t)?t.forEach((t,i)=>{const o=this.createNode(t,i.toString(),n);e.appendChild(o)}):Object.entries(t).forEach(([t,i])=>{const o=this.createNode(i,t,n);e.appendChild(o)})}getJsPath(e){let t="";return e.forEach(e=>{"number"==typeof e?t+=`[${e}]`:/^[a-zA-Z_$][a-zA-Z0-9_$]*$/.test(e)?t+=`.${e}`:t+=`["${String(e).replace(/"/g,'\\"')}"]`}),t}getJsonPointer(e){return e&&0!==e.length?"/"+e.map(e=>String(e).replace(/~/g,"~0").replace(/\//g,"~1")).join("/"):"/"}formatValue(e,t){switch(t){case"string":return`"${e}"`;case"null":return"null";case"boolean":return e?"true":"false";default:return String(e)}}expandAll(){this.expandedPaths.clear(),this.data&&this.collectAllPaths(this.data,[]),this.render()}collectAllPaths(e,t){const n=JsonUtils.getType(e);if("object"===n||"array"===n){const n=JSON.stringify(t);this.expandedPaths.add(n),Array.isArray(e)?e.forEach((e,n)=>{this.collectAllPaths(e,[...t,n.toString()])}):Object.entries(e).forEach(([e,n])=>{this.collectAllPaths(n,[...t,e])})}}collapseAll(){this.expandedPaths.clear(),this.render()}clear(){this.data=null,this.expandedPaths.clear(),this.container.innerHTML='<p class="table-placeholder">No data to display</p>'}};const r={container:null,data:null,init(){this.container=document.getElementById("table-view")},render(e){try{const t=JSON.parse(e);if(this.data=t,!Array.isArray(t)){if("object"==typeof t&&null!==t){const e=Object.entries(t).find(([,e])=>Array.isArray(e)&&e.length>0);if(e)return void this.renderTable(e[1],e[0])}return void(this.container.innerHTML='<p class="table-placeholder">Table view works best with arrays of objects. Switch to Tree view for this data.</p>')}if(0===t.length)return void(this.container.innerHTML='<p class="table-placeholder">Empty array</p>');this.renderTable(t)}catch(t){this.container.innerHTML=`<p class="error" style="color: var(--color-error);">Invalid JSON: ${t.message}</p>`}},renderTable(e,t=null){const n=new Set;e.forEach(e=>{"object"!=typeof e||null===e||Array.isArray(e)||Object.keys(e).forEach(e=>n.add(e))});const i=Array.from(n);if(0===i.length)return void this.renderPrimitiveArray(e);let o="";t&&(o+=`<h3 style="margin-bottom: var(--space-md); color: var(--color-text-secondary);">${t}</h3>`),o+='<table class="json-table">',o+="<thead><tr>",o+="<th>#</th>",i.forEach(e=>{o+=`<th>${this.escapeHtml(e)}</th>`}),o+="</tr></thead>",o+="<tbody>",e.forEach((e,t)=>{o+="<tr>",o+=`<td>${t}</td>`,i.forEach(t=>{const n=e&&e[t];o+=`<td title="${this.escapeHtml(this.formatTooltip(n))}">${this.formatCell(n)}</td>`}),o+="</tr>"}),o+="</tbody></table>",this.container.innerHTML=o},renderPrimitiveArray(e){let t='<table class="json-table">';t+="<thead><tr><th>#</th><th>Value</th></tr></thead>",t+="<tbody>",e.forEach((e,n)=>{t+=`<tr><td>${n}</td><td>${this.formatCell(e)}</td></tr>`}),t+="</tbody></table>",this.container.innerHTML=t},formatCell(e){if(null===e)return'<span style="color: var(--json-null); font-style: italic;">null</span>';if(void 0===e)return'<span style="color: var(--color-text-muted);">-</span>';const t=typeof e;if("boolean"===t)return`<span style="color: var(--json-boolean);">${e}</span>`;if("number"===t)return`<span style="color: var(--json-number);">${e}</span>`;if("string"===t){const t=this.escapeHtml(e);return e.length>50?`<span style="color: var(--json-string);">"${t.substring(0,50)}..."</span>`:`<span style="color: var(--json-string);">"${t}"</span>`}return Array.isArray(e)?`<span style="color: var(--color-text-muted);">Array[${e.length}]</span>`:"object"===t?`<span style="color: var(--color-text-muted);">Object{${Object.keys(e).length}}</span>`:this.escapeHtml(String(e))},formatTooltip:e=>null==e?String(e):"object"==typeof e?JSON.stringify(e,null,2):String(e),escapeHtml(e){const t=document.createElement("div");return t.textContent=String(e),t.innerHTML},clear(){this.data=null,this.container.innerHTML='<p class="table-placeholder">Table view works best with arrays of objects</p>'}};window.TableView=r;const s={init(){const e=localStorage.getItem("jsonlab-theme");if(e)this.set(e);else{const e=window.matchMedia("(prefers-color-scheme: dark)").matches;this.set(e?"dark":"light")}window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{localStorage.getItem("jsonlab-theme")||this.set(e.matches?"dark":"light")})},set(e){document.documentElement.setAttribute("data-theme",e),this.updateIcon(e),window.App&&"function"==typeof window.App.updateTheme&&window.App.updateTheme()},get:()=>document.documentElement.getAttribute("data-theme")||"light",toggle(){const e="dark"===this.get()?"light":"dark";this.set(e),localStorage.setItem("jsonlab-theme",e)},updateIcon(e){const t=document.getElementById("theme-icon");if(t){const n="dark"===e?"sun":"moon";t.setAttribute("data-lucide",n),window.lucide&&lucide.createIcons()}}};window.Theme=s;const a={activeModal:null,show(e){const t=document.getElementById(e);if(t){t.classList.remove("hidden"),this.activeModal=t;const n=t.querySelector("input");n&&setTimeout(()=>n.focus(),100),t.addEventListener("click",n=>{n.target===t&&this.hide(e)}),document.addEventListener("keydown",this.escapeHandler)}},hide(e){const t=document.getElementById(e);t&&(t.classList.add("hidden"),this.activeModal=null,document.removeEventListener("keydown",this.escapeHandler))},escapeHandler(e){"Escape"===e.key&&a.activeModal&&a.hide(a.activeModal.id)},alert:(e,t="Alert")=>new Promise(n=>{const i=document.createElement("div");i.className="modal",i.innerHTML=`\n                <div class="modal-content">\n                    <h2>${t}</h2>\n                    <p>${e}</p>\n                    <div class="modal-actions">\n                        <button class="btn btn-primary" id="alert-ok">OK</button>\n                    </div>\n                </div>\n            `,document.body.appendChild(i),i.querySelector("#alert-ok").addEventListener("click",()=>{i.remove(),n()}),i.addEventListener("click",e=>{e.target===i&&(i.remove(),n())})}),confirm:(e,t="Confirm")=>new Promise(n=>{const i=document.createElement("div");i.className="modal",i.innerHTML=`\n                <div class="modal-content">\n                    <h2>${t}</h2>\n                    <p>${e}</p>\n                    <div class="modal-actions">\n                        <button class="btn btn-secondary" id="confirm-cancel">Cancel</button>\n                        <button class="btn btn-primary" id="confirm-ok">OK</button>\n                    </div>\n                </div>\n            `,document.body.appendChild(i),i.querySelector("#confirm-ok").addEventListener("click",()=>{i.remove(),n(!0)}),i.querySelector("#confirm-cancel").addEventListener("click",()=>{i.remove(),n(!1)}),i.addEventListener("click",e=>{e.target===i&&(i.remove(),n(!1))})})};window.Modal=a;const l={init(){var e,t,n,i,o,r,s,a,l,d,c,u,h,p,m,y,f,g,v;null==(e=document.getElementById("btn-format"))||e.addEventListener("click",()=>{App.format()}),null==(t=document.getElementById("btn-compact"))||t.addEventListener("click",()=>{App.compact()}),null==(n=document.getElementById("btn-validate"))||n.addEventListener("click",()=>{App.validate()}),null==(i=document.getElementById("btn-repair"))||i.addEventListener("click",()=>{App.repair()}),null==(o=document.getElementById("btn-undo"))||o.addEventListener("click",()=>{App.undo()}),null==(r=document.getElementById("btn-redo"))||r.addEventListener("click",()=>{App.redo()}),null==(s=document.getElementById("btn-copy"))||s.addEventListener("click",()=>{App.copyToClipboard()}),null==(a=document.getElementById("btn-clear"))||a.addEventListener("click",()=>{App.clear()}),null==(l=document.getElementById("btn-compare"))||l.addEventListener("click",()=>{App.toggleCompareMode()}),null==(d=document.getElementById("btn-query"))||d.addEventListener("click",()=>{App.toggleQueryMode()}),null==(c=document.getElementById("btn-import"))||c.addEventListener("click",()=>{document.getElementById("file-input").click()}),null==(u=document.getElementById("file-input"))||u.addEventListener("change",e=>{const t=e.target.files[0];t&&App.importFile(t),e.target.value=""}),null==(h=document.getElementById("btn-import-url"))||h.addEventListener("click",()=>{Modal.show("url-modal")}),null==(p=document.getElementById("btn-url-cancel"))||p.addEventListener("click",()=>{Modal.hide("url-modal")}),null==(m=document.getElementById("btn-url-load"))||m.addEventListener("click",()=>{const e=document.getElementById("url-input").value;e&&(App.importFromUrl(e),Modal.hide("url-modal"))}),null==(y=document.getElementById("btn-export"))||y.addEventListener("click",()=>{App.export()}),null==(f=document.getElementById("btn-theme"))||f.addEventListener("click",()=>{Theme.toggle()}),document.querySelectorAll(".mode-tab").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.mode;App.switchMode(t)})}),null==(g=document.getElementById("btn-run-query"))||g.addEventListener("click",()=>{App.runQuery()}),null==(v=document.getElementById("query-input"))||v.addEventListener("keydown",e=>{"Enter"===e.key&&App.runQuery()}),document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.shiftKey&&"F"===e.key&&(e.preventDefault(),App.format()),(e.ctrlKey||e.metaKey)&&"s"===e.key&&(e.preventDefault(),App.export()),(e.ctrlKey||e.metaKey)&&"o"===e.key&&(e.preventDefault(),document.getElementById("file-input").click()),(e.ctrlKey||e.metaKey)&&"d"===e.key&&(e.preventDefault(),Theme.toggle())}),this.setupDragDrop(),window.lucide&&lucide.createIcons()},setupDragDrop(){const e=document.getElementById("app"),t=document.createElement("div");t.className="drop-overlay hidden",t.innerHTML='<div class="drop-overlay-text">Drop JSON file here</div>',document.body.appendChild(t);let n=0;e.addEventListener("dragenter",e=>{e.preventDefault(),n++,t.classList.remove("hidden")}),e.addEventListener("dragleave",e=>{e.preventDefault(),n--,0===n&&t.classList.add("hidden")}),e.addEventListener("dragover",e=>{e.preventDefault()}),e.addEventListener("drop",e=>{e.preventDefault(),n=0,t.classList.add("hidden");const i=e.dataTransfer.files[0];i&&App.importFile(i)})}};window.Toolbar=l;window.EditorToolbar=class{constructor(e,t){this.container=e,this.editor=t,this.element=null,this.render(),this.bindEvents()}render(){this.element=document.createElement("div"),this.element.className="toolbar",this.element.innerHTML='\n            <div class="toolbar-group mode-tabs-group">\n                <button class="mode-tab active" data-mode="text" title="Text Mode">\n                    <i data-lucide="file-text" class="icon"></i> Text\n                </button>\n                <button class="mode-tab" data-mode="tree" title="Tree Mode">\n                    <i data-lucide="list-tree" class="icon"></i> Tree\n                </button>\n                <button class="mode-tab" data-mode="table" title="Table Mode">\n                    <i data-lucide="table" class="icon"></i> Table\n                </button>\n            </div>\n\n            <div class="toolbar-divider"></div>\n            \n            <div class="toolbar-group">\n                <button class="btn btn-secondary btn-icon btn-expand" title="Expand All">\n                    <i data-lucide="chevrons-up-down" class="icon"></i>\n                </button>\n                <button class="btn btn-secondary btn-icon btn-collapse" title="Collapse All">\n                    <i data-lucide="chevrons-down-up" class="icon"></i>\n                </button>\n            </div>\n            \n            <div class="toolbar-divider"></div>\n            \n            <div class="toolbar-group">\n                <button class="btn btn-secondary btn-icon btn-format" title="Format JSON (Ctrl+Shift+F)">\n                    <i data-lucide="align-left" class="icon"></i>\n                </button>\n                <button class="btn btn-secondary btn-icon btn-compact" title="Compact JSON">\n                    <i data-lucide="minimize" class="icon"></i>\n                </button>\n            <div class="toolbar-divider"></div>\n               \n            </div>\n            <div class="toolbar-group">\n                <button class="btn btn-secondary btn-icon btn-undo" title="Undo (Ctrl+Z)" disabled>\n                    <i data-lucide="undo" class="icon"></i>\n                </button>\n                <button class="btn btn-secondary btn-icon btn-redo" title="Redo (Ctrl+Y)" disabled>\n                    <i data-lucide="redo" class="icon"></i>\n                </button>\n            </div>\n            <div class="toolbar-group">\n                <button class="btn btn-secondary btn-icon btn-copy" title="Copy to clipboard">\n                    <i data-lucide="copy" class="icon"></i>\n                </button>\n                <button class="btn btn-secondary btn-icon btn-clear" title="Clear editor">\n                    <i data-lucide="trash-2" class="icon"></i>\n                </button>\n            </div>\n            <div class="toolbar-group toolbar-group-right">\n                 \x3c!-- Global app actions or specific editor actions can go here --\x3e\n            </div>\n        ',this.container.appendChild(this.element),window.lucide&&lucide.createIcons({root:this.element})}bindEvents(){const e=(e,t)=>{const n=this.element.querySelector(e);n&&n.addEventListener("click",t)};e(".btn-format",()=>this.editor.format()),e(".btn-compact",()=>this.editor.compact()),e(".btn-validate",()=>this.editor.validate()),e(".btn-repair",()=>this.editor.repair()),e(".btn-expand",()=>this.editor.expandAll()),e(".btn-collapse",()=>this.editor.collapseAll()),e(".btn-undo",()=>this.editor.undo()),e(".btn-redo",()=>this.editor.redo()),e(".btn-copy",()=>this.editor.copyToClipboard()),e(".btn-clear",()=>this.editor.clear()),this.element.querySelectorAll(".mode-tab").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.mode;this.editor.switchMode(t),this.element.querySelectorAll(".mode-tab").forEach(e=>e.classList.remove("active")),e.classList.add("active")})})}updateUndoRedo(e,t){const n=this.element.querySelector(".btn-undo"),i=this.element.querySelector(".btn-redo");n&&(n.disabled=!e),i&&(i.disabled=!t)}addButton(e){const t=e.position||"right";let n;if("left"===t){if(n=this.element.querySelector(".toolbar-group-custom-left"),!n){n=document.createElement("div"),n.className="toolbar-group toolbar-group-custom-left";const e=this.element.firstChild;this.element.insertBefore(n,e);const t=document.createElement("div");t.className="toolbar-divider",this.element.insertBefore(t,e.nextSibling)}}else n=this.element.querySelector(".toolbar-group-right");if(!n)return;const i=document.createElement("button");return i.className=`btn btn-secondary ${e.className||""}`,i.title=e.title,i.innerHTML=`<i data-lucide="${e.icon}" class="icon"></i> ${e.label||""}`,i.addEventListener("click",()=>{e.onClick&&e.onClick()}),"right"===t?n.insertBefore(i,n.firstChild):n.appendChild(i),window.lucide&&lucide.createIcons({root:i}),i}};window.JsonEditor=class{constructor(e,t,n="text"){this.container=e,this.id=t,this.mode=n,this.editor=null,this.history=[],this.historyIndex=-1,this.maxHistory=50,this.wrapper=document.createElement("div"),this.wrapper.className="editor-instance",this.container.appendChild(this.wrapper),this.init()}async init(){this.createPrimaryToolbar(),this.toolbarContainer=document.createElement("div"),this.wrapper.appendChild(this.toolbarContainer),this.toolbar=new EditorToolbar(this.toolbarContainer,this),this.mainContent=document.createElement("div"),this.mainContent.className="editor-main-content",this.mainContent.style.flex="1",this.mainContent.style.position="relative",this.mainContent.style.overflow="hidden",this.wrapper.appendChild(this.mainContent),this.createPanels(),this.createStatusBar(),await this.initMonaco(),this.switchMode(this.mode),this.saveToHistory()}createPrimaryToolbar(){this.primaryToolbar=document.createElement("div"),this.primaryToolbar.className="toolbar primary-toolbar",this.primaryToolbar.innerHTML='\n            <div class="toolbar-group toolbar-group-left">\n                <button class="btn btn-secondary btn-sm btn-new" title="New / Clear Editor">\n                    <i data-lucide="file-plus" class="icon"></i> New\n                </button>\n                <button class="btn btn-secondary btn-sm btn-import-file" title="Import File">\n                    <i data-lucide="folder-open" class="icon"></i> Import\n                </button>\n                <button class="btn btn-secondary btn-sm btn-import-url" title="Import from URL">\n                    <i data-lucide="link" class="icon"></i> URL\n                </button>\n                <button class="btn btn-secondary btn-sm btn-export" title="Export File">\n                    <i data-lucide="save" class="icon"></i> Export\n                </button>\n            </div>\n            <div class="toolbar-group toolbar-group-right"></div>\n             <input type="file" class="hidden-file-input" accept=".json,.csv,.txt" hidden>\n        ',this.wrapper.appendChild(this.primaryToolbar);const e=this.primaryToolbar.querySelector(".hidden-file-input");this.primaryToolbar.querySelector(".btn-new").addEventListener("click",()=>{this.clear()}),this.primaryToolbar.querySelector(".btn-import-file").addEventListener("click",()=>{e.click()}),e.addEventListener("change",e=>{e.target.files[0]&&this.importFile(e.target.files[0]),e.target.value=""}),this.primaryToolbar.querySelector(".btn-import-url").addEventListener("click",()=>{window.Modal&&window.App&&(window.App.pendingImportTarget=this,Modal.show("url-modal"))}),this.primaryToolbar.querySelector(".btn-export").addEventListener("click",()=>{this.exportFile()}),window.lucide&&lucide.createIcons({root:this.primaryToolbar})}importFile(e){const t=new FileReader;t.onload=t=>{const n=t.target.result;this.handleImportContent(n,e.name.endsWith(".csv"))},t.readAsText(e)}handleImportContent(e,t){let n=e;if(t&&window.CsvUtils)try{const t=CsvUtils.detectDelimiter(e),i=CsvUtils.csvToJson(e,t);n=JSON.stringify(i,null,2)}catch(i){return console.error("CSV Import Error",i),void(window.App&&App.showToast("CSV Error: "+i.message,"error"))}else if(window.JsonUtils)try{n=JsonUtils.format(e)}catch{}if(this.setValue(n),window.App&&App.showToast("File loaded","success"),"left"===this.id&&window.App){const e=App.editors.find(e=>"right"===e.id);e&&e.setValue(n)}}exportFile(){const e=this.getValue();if(!e)return;const t=new Blob([e],{type:"application/json"}),n=URL.createObjectURL(t),i=document.createElement("a");i.href=n,i.download=`data-${this.id}.json`,i.click(),URL.revokeObjectURL(n)}addPrimaryButton(e){if(!this.primaryToolbar)return;const t=e.position||"right";let n;if(n="left"===t?this.primaryToolbar.querySelector(".toolbar-group-left"):this.primaryToolbar.querySelector(".toolbar-group-right"),!n)return;const i=document.createElement("button");return i.className=`btn btn-secondary btn-sm ${e.className||""}`,i.title=e.title,i.innerHTML=`<i data-lucide="${e.icon}" class="icon"></i> ${e.label||""}`,i.addEventListener("click",()=>{e.onClick&&e.onClick()}),"left"===t?n.insertBefore(i,n.firstChild):n.appendChild(i),window.lucide&&lucide.createIcons({root:i}),i}createPanels(){this.textPanel=document.createElement("div"),this.textPanel.className="editor-panel",this.textPanel.id=`text-panel-${this.id}`,this.textPanel.innerHTML=`<div class="monaco-container" id="monaco-${this.id}"></div>`,this.mainContent.appendChild(this.textPanel),this.treePanel=document.createElement("div"),this.treePanel.className="editor-panel",this.treePanel.id=`tree-panel-${this.id}`,this.treePanel.innerHTML=`<div class="tree-container" id="tree-view-${this.id}"></div>`,this.mainContent.appendChild(this.treePanel),this.tablePanel=document.createElement("div"),this.tablePanel.className="editor-panel",this.tablePanel.id=`table-panel-${this.id}`,this.tablePanel.innerHTML=`\n            <div class="table-container" id="table-view-${this.id}">\n                 <p class="table-placeholder">Table view works best with arrays of objects</p>\n            </div>`,this.mainContent.appendChild(this.tablePanel)}createStatusBar(){this.statusBar=document.createElement("footer"),this.statusBar.className="status-bar",this.statusBar.innerHTML='\n            <div class="status-left">\n                <span class="status-validation">Ready</span>\n                <span class="status-path"></span>\n            </div>\n            <div class="status-right">\n                <span class="status-size">0 bytes</span>\n                <span class="status-lines">0 lines</span>\n            </div>\n        ',this.wrapper.appendChild(this.statusBar)}async initMonaco(){window.monaco||await new Promise(e=>setTimeout(e,100));const e=this.textPanel.querySelector(".monaco-container");this.editor=monaco.editor.create(e,{value:"{}",language:"json",theme:"dark"===document.documentElement.getAttribute("data-theme")?"json-dark":"json-light",automaticLayout:!0,folding:!0,wordWrap:"on",tabSize:2,minimap:{enabled:!1},lineNumbers:"on",formatOnPaste:!0,formatOnType:!0}),this.editor.onDidChangeModelContent(()=>{this.onContentChange()}),this.editor.onDidFocusEditorWidget(()=>{window.App&&window.App.setActiveEditor(this)}),this.editor.onDidChangeCursorPosition(e=>{this.onCursorChange(e)})}onCursorChange(e){if(window.JsonUtils&&window.TreeView)try{const t=this.editor.getModel(),n=t.getOffsetAt(e.position),i=t.getValue(),o=JsonUtils.getPathAtOffset(i,n);let r="",s="";o&&(r=this.getJsPath(o),s=this.getJsonPointer(o)),this.updatePathDisplay(r,s)}catch(t){console.error("Error calculating path:",t),this.updatePathDisplay("","")}}getJsPath(e){let t="";return e.forEach(e=>{"number"==typeof e?t+=`[${e}]`:/^[a-zA-Z_$][a-zA-Z0-9_$]*$/.test(e)?t+=`.${e}`:t+=`["${String(e).replace(/"/g,'\\"')}"]`}),t}getJsonPointer(e){return e&&0!==e.length?"/"+e.map(e=>String(e).replace(/~/g,"~0").replace(/\//g,"~1")).join("/"):"/"}updatePathDisplay(e,t){const n=this.statusBar.querySelector(".status-path");n&&(e||t?(n.innerHTML=`\n            <span class="path-separator"> | </span>\n            <span class="path-display" title="Click to copy JS Path">JS: <code>${e}</code></span>\n            <span class="path-separator"> | </span>\n            <span class="path-display" title="Click to copy JSONPointer">JSONPointer: <code>${t}</code></span>\n        `,n.querySelectorAll(".path-display").forEach(e=>{e.onclick=()=>{const t=e.querySelector("code").textContent;navigator.clipboard.writeText(t),window.App&&App.showToast("Path copied","success")}})):n.innerHTML="")}updateTheme(){if(this.editor){const e="dark"===document.documentElement.getAttribute("data-theme")?"json-dark":"json-light";monaco.editor.setTheme(e)}}switchMode(e){this.mode=e,[this.textPanel,this.treePanel,this.tablePanel].forEach(e=>e.classList.remove("active"));const t=this.getValue();switch(e){case"text":this.textPanel.classList.add("active");break;case"tree":this.treePanel.classList.add("active"),this.treeView||(this.treeView=new TreeView(this.treePanel.querySelector(".tree-container"))),this.treeView.render(t);break;case"table":this.tablePanel.classList.add("active"),window.TableView&&"function"==typeof window.TableView.render&&window.TableView.render(t,this.tablePanel.querySelector(".table-container"))}}getValue(){return this.editor?this.editor.getValue():""}setValue(e){this.editor&&(this.editor.setValue(e),"text"!==this.mode&&this.switchMode(this.mode))}onContentChange(){this.updateStatusBar(),this.saveToHistory()}updateStatusBar(){const e=this.getValue(),t=window.JsonUtils?JsonUtils.getSize(e):{sizeStr:"0 B",lines:0};this.statusBar.querySelector(".status-size").textContent=t.sizeStr,this.statusBar.querySelector(".status-lines").textContent=`${t.lines} lines`;const n=window.JsonUtils?JsonUtils.validate(e):{valid:!0},i=this.statusBar.querySelector(".status-validation");if(n.valid)i.textContent="Valid JSON",i.className="status-validation success";else{i.className="status-validation error",i.innerHTML=`<span>Error: ${n.error}</span>`;let t=!1;if(window.JsonUtils)try{const n=JsonUtils.repair(e);if(n!==e){t=JsonUtils.validate(n).valid}}catch{t=!1}if(t){const e=document.createElement("button");e.className="btn btn-primary btn-repair-status",e.innerHTML='<i data-lucide="wrench" style="width:12px;height:12px;vertical-align:middle;margin-right:4px;"></i>Auto Repair',e.title="Attempt to fix common JSON errors",e.onclick=()=>this.repair(),i.appendChild(e),window.lucide&&lucide.createIcons({root:e})}}this.toolbar.updateUndoRedo(this.historyIndex>0,this.historyIndex<this.history.length-1)}format(){const e=this.getValue();if(window.JsonUtils)try{this.setValue(JsonUtils.format(e))}catch(t){console.error(t)}}compact(){const e=this.getValue();if(window.JsonUtils)try{this.setValue(JsonUtils.compact(e))}catch(t){console.error(t)}}validate(){window.App&&App.showToast(this.statusBar.querySelector(".status-validation").textContent)}repair(){const e=this.getValue();if(window.JsonUtils)try{this.setValue(JsonUtils.repair(e))}catch(t){console.error(t)}}expandAll(){"text"===this.mode&&this.editor?this.editor.trigger("anyString","editor.unfoldAll"):"tree"===this.mode&&this.treeView&&this.treeView.expandAll()}collapseAll(){"text"===this.mode&&this.editor?this.editor.trigger("anyString","editor.foldAll"):"tree"===this.mode&&this.treeView&&this.treeView.collapseAll()}undo(){this.historyIndex>0&&(this.historyIndex--,this.setValue(this.history[this.historyIndex]))}redo(){this.historyIndex<this.history.length-1&&(this.historyIndex++,this.setValue(this.history[this.historyIndex]))}saveToHistory(){const e=this.getValue();this.history[this.historyIndex]!==e&&(this.history=this.history.slice(0,this.historyIndex+1),this.history.push(e),this.history.length>this.maxHistory?this.history.shift():this.historyIndex++)}async copyToClipboard(){try{await navigator.clipboard.writeText(this.getValue()),window.App&&App.showToast("Copied to clipboard","success")}catch(e){window.App&&App.showToast("Failed to copy: "+e.message,"error")}}clear(){this.setValue("")}};const d={editors:[],activeEditor:null,async init(){Theme.init(),await TextEditor.load();const e=document.getElementById("editors-container");e.innerHTML="",this.createEditors(e),console.log("JSON Editor initialized")},createEditors(e){const t=document.createElement("div");t.className="editor-wrapper",t.id="editor-wrapper-left",t.style.flex="1",t.style.display="flex",t.style.flexDirection="column",t.style.borderRight="1px solid var(--color-border)",t.style.minWidth="0",e.appendChild(t);const n=new JsonEditor(t,"left","text");this.editors.push(n);const i=document.createElement("div");i.className="editor-wrapper",i.id="editor-wrapper-right",i.style.flex="1",i.style.display="flex",i.style.flexDirection="column",i.style.minWidth="0",e.appendChild(i);const o=new JsonEditor(i,"right","text");this.editors.push(o);const r=document.createElement("div");r.className="editor-splitter",r.id="editors-splitter",e.insertBefore(r,i),this.setActiveEditor(n),n.setValue(TextEditor.getDefaultJson()),o.setValue(n.getValue()),this.copyToRightBtn=n.addPrimaryButton({icon:"arrow-right",title:"Copy content to Right Editor",className:"btn-copy-right",position:"right",onClick:()=>{const e=n.getValue();o.setValue(e),this.showToast("Copied to Right Editor","success")}}),o.addPrimaryButton({icon:"arrow-left",title:"Copy content to Left Editor",position:"left",onClick:()=>{const e=o.getValue();n.setValue(e),this.showToast("Copied to Left Editor","success")}}),this.switchGlobalMode("normal"),this.initSplitResizer()},setActiveEditor(e){this.activeEditor=e,document.querySelectorAll(".editor-wrapper").forEach(e=>e.classList.remove("active-wrapper")),e.wrapper.parentNode.classList.add("active-wrapper")},format(){var e;null==(e=this.activeEditor)||e.format()},compact(){var e;null==(e=this.activeEditor)||e.compact()},validate(){var e;null==(e=this.activeEditor)||e.validate()},repair(){var e;null==(e=this.activeEditor)||e.repair()},undo(){var e;null==(e=this.activeEditor)||e.undo()},redo(){var e;null==(e=this.activeEditor)||e.redo()},copyToClipboard(){var e;null==(e=this.activeEditor)||e.copyToClipboard()},clear(){var e;null==(e=this.activeEditor)||e.clear()},switchMode(e){var t;null==(t=this.activeEditor)||t.switchMode(e)},bindHeaderEvents(){var e,t,n,i,o,r,s,a;this.pendingImportTarget=null,null==(e=document.getElementById("btn-url-cancel"))||e.addEventListener("click",()=>{Modal.hide("url-modal"),this.pendingImportTarget=null}),null==(t=document.getElementById("btn-url-load"))||t.addEventListener("click",()=>{const e=document.getElementById("url-input").value;e&&(this.importFromUrl(e,this.pendingImportTarget),Modal.hide("url-modal"),this.pendingImportTarget=null)}),null==(n=document.getElementById("btn-theme"))||n.addEventListener("click",()=>{Theme.toggle()}),document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.shiftKey&&"F"===e.key&&(e.preventDefault(),this.format()),(e.ctrlKey||e.metaKey)&&"d"===e.key&&(e.preventDefault(),Theme.toggle()),!e.ctrlKey&&!e.metaKey||e.shiftKey||"z"!==e.key||(e.preventDefault(),this.undo()),((e.ctrlKey||e.metaKey)&&e.shiftKey&&"z"===e.key||(e.ctrlKey||e.metaKey)&&"y"===e.key)&&(e.preventDefault(),this.redo())}),null==(i=document.getElementById("btn-mode-normal"))||i.addEventListener("click",()=>this.switchGlobalMode("normal")),null==(o=document.getElementById("btn-mode-split"))||o.addEventListener("click",()=>this.switchGlobalMode("split")),null==(r=document.getElementById("btn-mode-compare"))||r.addEventListener("click",()=>this.switchGlobalMode("compare")),null==(s=document.getElementById("btn-mode-query"))||s.addEventListener("click",()=>this.switchGlobalMode("query"));const l=document.getElementById("query-input");if(l){let e;l.addEventListener("input",()=>{clearTimeout(e),e=setTimeout(()=>this.runQuery(),300)})}null==(a=document.getElementById("btn-query-apply"))||a.addEventListener("click",()=>this.applyQueryResult())},switchGlobalMode(e){var t;document.querySelectorAll(".header-actions .btn").forEach(e=>e.classList.remove("active")),null==(t=document.getElementById(`btn-mode-${e}`))||t.classList.add("active");const n=document.getElementById("editors-container");n.style.display="none",document.getElementById("compare-panel").style.display="none",document.getElementById("query-panel").style.display="none";const i=document.getElementById("editors-splitter");i&&(i.style.display="none");const o=document.getElementById("editor-wrapper-left"),r=document.getElementById("editor-wrapper-right");o&&(o.style.display="flex"),r&&(r.style.display="flex"),"normal"===e?(n.style.display="flex",r&&(r.style.display="none"),o&&(o.style.borderRight="none"),this.copyToRightBtn&&(this.copyToRightBtn.style.display="none")):"split"===e?(n.style.display="flex",r&&(r.style.display="flex"),o&&(o.style.borderRight="1px solid var(--color-border)"),i&&(i.style.display="flex"),this.copyToRightBtn&&(this.copyToRightBtn.style.display="inline-flex")):"compare"===e?(document.getElementById("compare-panel").style.display="flex",this.initCompare()):"query"===e&&(document.getElementById("query-panel").style.display="flex",this.initQuery())},initCompare(){const e=this.editors[0].getValue(),t=this.editors[1].getValue();if(!this.diffEditor){const e=document.getElementById("monaco-diff-container");e&&(this.diffEditor=monaco.editor.createDiffEditor(e,{theme:"dark"===document.documentElement.getAttribute("data-theme")?"json-dark":"json-light",automaticLayout:!0,originalEditable:!0,readOnly:!1}),this.diffEditor.onDidUpdateDiff(()=>{this.updateDiffSummary()}))}if(this.diffEditor){const n=monaco.editor.createModel(e,"json"),i=monaco.editor.createModel(t,"json");this.diffEditor.setModel({original:n,modified:i});const o="dark"===document.documentElement.getAttribute("data-theme")?"json-dark":"json-light";monaco.editor.setTheme(o),this.updateDiffSummary()}const n=document.getElementById("diff-resize-handle"),i=document.getElementById("diff-summary"),o=document.getElementById("compare-panel");n&&i&&!n._resizeWired&&(n._resizeWired=!0,n.addEventListener("mousedown",e=>{e.preventDefault();const t=e.clientY,r=i.offsetHeight;n.classList.add("dragging");const s=e=>{const n=t-e.clientY,i=o.offsetHeight,s=Math.min(Math.max(40,r+n),Math.floor(.8*i));o.style.setProperty("--diff-summary-height",`${s}px`)},a=()=>{n.classList.remove("dragging"),document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",a)};document.addEventListener("mousemove",s),document.addEventListener("mouseup",a)}))},updateDiffSummary(){const e=this.diffEditor.getModel().original.getValue(),t=this.diffEditor.getModel().modified.getValue();let n="<p>No changes detected.</p>";try{const i=JSON.parse(e),o=JSON.parse(t);if(window.DiffUtils){const e=DiffUtils.compare(i,o);n=DiffUtils.formatDiffsHtml(e)}}catch{n='<p class="error">Invalid JSON for diff summary.</p>'}const i=document.getElementById("diff-summary");i&&(i.innerHTML=n)},initQuery(){if(document.getElementById("query-input").focus(),!this.queryInputEditor){const e=document.getElementById("query-editor-input"),t=document.getElementById("query-editor-output");if(e&&t){const n={theme:"dark"===document.documentElement.getAttribute("data-theme")?"json-dark":"json-light",automaticLayout:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,readOnly:!0,lineNumbers:"on",folding:!0};this.queryInputEditor=monaco.editor.create(e,{...n,value:"{}",language:"json"}),this.queryOutputEditor=monaco.editor.create(t,{...n,value:"",language:"json",readOnly:!0})}}if(this.queryInputEditor){const e=this.activeEditor?this.activeEditor.getValue():this.editors[0].getValue();this.queryInputEditor.setValue(e)}},runQuery(){const e=document.getElementById("query-input").value,t=this.queryInputEditor?this.queryInputEditor.getValue():"{}";try{const n=JSON.parse(t);if(console.log("Query:",e),window.QueryUtils){const t=QueryUtils.query(n,e),i=JSON.stringify(t,null,2);this.queryOutputEditor&&this.queryOutputEditor.setValue(i)}else this.queryOutputEditor&&this.queryOutputEditor.setValue("// QueryUtils not loaded")}catch(n){this.queryOutputEditor&&this.queryOutputEditor.setValue(`// Error: ${n.message}`)}},applyQueryResult(){if(!this.queryOutputEditor)return;const e=this.queryOutputEditor.getValue();if(e.startsWith("// Error"))return void this.showToast("Cannot apply error result","error");const t=this.activeEditor||this.editors[0];if(t.setValue(e),"left"===t.id){const t=this.editors.find(e=>"right"===e.id);t&&t.setValue(e)}this.showToast("Query result applied","success")},updateTheme(){this.editors.forEach(e=>{"function"==typeof e.updateTheme&&e.updateTheme()})},importFile(e){const t=new FileReader;t.onload=t=>{const n=t.target.result;this.handleImportContent(n,e.name.endsWith(".csv"))},t.onerror=()=>this.showToast("Failed to read file","error"),t.readAsText(e)},async importFromUrl(e){try{this.showToast("Loading...","info");const t=await fetch(e);if(!t.ok)throw new Error(`HTTP ${t.status}`);const n=await t.text();this.handleImportContent(n,!1)}catch(t){this.showToast(`Failed to load: ${t.message}`,"error")}},handleImportContent(e,t){let n=e;if(t)try{const t=CsvUtils.detectDelimiter(e),i=CsvUtils.csvToJson(e,t);n=JSON.stringify(i,null,2)}catch(o){return void this.showToast(`CSV import error: ${o.message}`,"error")}else try{n=JsonUtils.format(e)}catch{}const i=this.activeEditor||this.editors[0];if(i.setValue(n),"left"===i.id){const e=this.editors.find(e=>"right"===e.id);e&&e.setValue(n)}this.showToast("Content loaded","success")},export(){const e=this.activeEditor?this.activeEditor.getValue():"";if(!e)return;const t=new Blob([e],{type:"application/json"}),n=URL.createObjectURL(t),i=document.createElement("a");i.href=n,i.download="data.json",i.click(),URL.revokeObjectURL(n),this.showToast("File downloaded","success")},initSplitResizer(){const e=document.getElementById("editors-splitter"),t=document.getElementById("editor-wrapper-left"),n=document.getElementById("editor-wrapper-right"),i=document.getElementById("editors-container");e&&t&&n&&i&&e.addEventListener("mousedown",o=>{o.preventDefault(),e.classList.add("dragging");const r=e=>{const o=i.getBoundingClientRect(),r=o.width,s=e.clientX-o.left,a=Math.min(Math.max(10,s/r*100),90);t.style.flex=`0 0 ${a}%`,n.style.flex="1 1 0"},s=()=>{e.classList.remove("dragging"),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",s)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",s)})},updatePathDisplay(e,t){if(this.activeEditor&&this.activeEditor.statusBar){const n=this.activeEditor.statusBar.querySelector(".status-path");if(n){if(!e&&!t)return void(n.innerHTML="");n.innerHTML=`\n                    <span class="path-separator"> | </span>\n                    <span class="path-display" title="Click to copy JS Path">JS: <code>${e}</code></span>\n                    <span class="path-separator"> | </span>\n                    <span class="path-display" title="Click to copy JSONPointer">JSONPointer: <code>${t}</code></span>\n                `,n.querySelectorAll(".path-display").forEach(e=>{e.onclick=()=>{const t=e.querySelector("code").textContent;navigator.clipboard.writeText(t),this.showToast("Path copied","success")}})}}},onContentChange(){},showToast(e,t="info"){const n=document.querySelector(".toast");n&&n.remove();const i=document.createElement("div");i.className=`toast ${t}`,i.textContent=e,document.body.appendChild(i),setTimeout(()=>i.remove(),3e3)}};document.addEventListener("DOMContentLoaded",()=>{d.bindHeaderEvents(),d.init()}),window.App=d;
